<% let styles = ['<link rel="stylesheet" href="/css/styles-header.css"/>', '<link rel="stylesheet" href="/css/styles-footer.css"/>', '<link rel="stylesheet" href="/css/styles-mediaquery-medium-large.css" media="(min-width: 768px"/>', '<link rel="stylesheet" href="/css/productStyles.css"/>', '<link rel="stylesheet" href="/css/productStyles-mediaQuery.css" media="(min-width: 768px"/>'] %> 
<%- include("./partials/head", {"styles": styles}) %> 
<%- include("./partials/header") %>
<main>
    <section id="top">
        <div id="productPhotoCarousel" class="carousel slide" data-bs-ride="carousel">
            <ol class="carousel-indicators">
                <% for( let i = 0; i < fullPost.Post.Image_urls.length; i++ ) { %>
                    <li data-bs-target="#productPhotoCarousel" data-bs-slide-to=" <%= i %> "  <% if(i === 0){ %> <%- 'class="active"' %> <% } %> ></li>
                <% } %>              
            </ol>
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img src="<%= fullPost.Post.Image_urls.length ? `/img/products/${fullPost.Post.Image_urls[0]}` : '/img/products/no-image-found.jpeg' %>" class="d-block w-100" alt="...">
              </div>
              <% for( let i = 1; i < fullPost.Post.Image_urls.length; i++ ) { %>
                <div class="carousel-item">
                    <img src="<%= fullPost.Post.Image_urls.length && (fullPost.Image_urls)[i].includes("http") ? fullPost.Post.Image_urls[i] : `/img/products/${fullPost.Post.Image_urls[i]}` %>" class="d-block w-100" alt="...">
                  </div>
              <% } %>
            </div>
            <a class="carousel-control-prev" href="#productPhotoCarousel" role="button" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#productPhotoCarousel" role="button" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
        </div>
        <div id="mainDetails">
            <h2 class="price <%= fullPost.Post.onSale ? "inline stripped" : "" %>">$ <%= fullPost.Post.price.toLocaleString("es-AR") %> </h2>
            <% if (fullPost.Post.onSale) { %>
                <h5 class="price inline">
                    $<%= (fullPost.Post.price * (100 - fullPost.Post.discount) / 100).toLocaleString("es-AR") %> 
                </h5>
            <% } %>
            <%- fullPost.Post.published ? `<p class="date">Publicado el ${fullPost.Post.publishedDate.toLocaleString("es-AR")}</p>` : '<p class="date"> El producto no ha sido publicado todavía </p>' %> 
            <h2 class="title"><%= fullPost.Post.title %> </h2>
            <p class="product-state"><%= fullPost.Post.state %></p>
            <p class="location">Ubicación: <%= product.location.neighbourhood %>,
                <% if (product.location.city === product.location.province) { %>
                    <%= product.location.city %>
                <% } else { %>
                    <%= product.location.city %>,<%= product.location.province %>
                <% } %>
             </p>
            <h5>Vendedor: <span class="seller"><%= (locals.seller && seller.userName) ? seller.userName : "" %></span></h5> 
            <% if (fullPost.Post.Product.product_type === "part") { %>
                <p class="product-shipping">Costo de envío <span class="product-shipping-price">$250</span></p> <!-- to be replaced with dynamic data once shipping service cost is implemented -->
            <% } %>
            <div class="rating-container">
                <p id="rating">Rating</p>
                <% for( let i = 0; i < fullPost.Post.rating; i++ ) { %>
                    <i class="fas fa-star"></i>
                <% } %>
                <% if (fullPost.Post.rating < 5 ) { %>
                    <% for( let i = 0; i < (5 - fullPost.Post.rating); i++ ) { %>
                        <i class="far fa-star"></i>
                    <% } %>
                <% } %>
            </div>
            <% if (fullPost.Post.Product.product_type === "vehicle") { %>
                <div class="buttons-container">
                    <% if (locals.assertUserLogged) { %>
                        <button type="button" class="btn btn-primary">Preguntar</button>
                        <button type="button" class="btn btn-secondary">Reservar</button>
                        <i class="far fa-heart"></i>
                    <% } %>                    
                    <button type="button" class="btn btn-success"><i class="fas fa-share-alt"></i> Compartir</button>
                </div>
            
            <% } else if (fullPost.Post.Product.product_type === "part") { %>
                <div class="buttons-container">
                    <% if (locals.assertUserLogged) { %>
                        <button type="button" class="btn btn-primary">Comprar</button>
                        <button type="button" class="btn btn-secondary">Preguntar</button>
                        <a href="/cart/addItem/<%=fullPost.Post.postID%>"><button type="button" class="btn btn-danger"><i class="fas fa-cart-plus"></i></button></a>
                        <i class="far fa-heart"></i>
                    <% } %>
                    <button type="button" class="btn btn-success"><i class="fas fa-share-alt"></i> Compartir</button>
                </div>
                <div class="payment-methods-link">
                    <a data-bs-toggle="modal" data-bs-target="#paymentMethodsModal"><i class="fas fa-credit-card"></i> Medios de pago</a>
                </div>
            <% } %>
            <% if (locals.assertUserLogged && assertUserLogged.userID === fullPost.Post.sellerID) { %>
                <div class="btn-edit-container">
                    <a href="/products/edit/<%= fullPost.Post.Product.product_type %>/<%= fullPost.Post.postID %>">
                        <button type="button" class="btn btn-warning btn-edit">Editar</button>
                    </a>
                </div>     
            <% } %>            
        </div>
    </section>
    <section>
        <% if (fullPost.Post.Product.product_type === "vehicle") { %>
            <div id="characteristics">
                <h2>Características principales</h2>
                <table class="table table-striped table-hover" id="attributesTable">
                    <tr>
                        <td>
                            <strong>Marca: </strong><%= brand.brandName %> 
                        </td>
                        <td>
                            <strong>Modelo: </strong><%= model.modelName %> 
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Versión: </strong> <%= version.versionName %> 
                        </td>
                        <td>
                            <strong>Año: </strong> <%= fullPost.Vehicle.year %> 
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Kilometraje: </strong> <%= fullPost.Vehicle.kilometers %>
                        </td>
                        <td>
                            <strong>Color: </strong> <%= fullPost.Vehicle.color %>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Estado: </strong> <%= fullPost.Post.state %>
                        </td>
                        <td>
                            <strong>Transmisión: </strong> <%= fullPost.Vehicle.gearType %>
                        </td>
                    </tr>
                </table>
            </div>
        <% } %>
        
        <div id="description">
            <h2>Descripción</h2>
            <p>
                <%= fullPost.Vehicle.description %> 
            </p>
        </div>
        <% if (fullPost.Post.Product.product_type === "vehicle") { %>
            <%- include("./partials/vehicleDatasheet") %> 
        <% } %>
        <div id="questions">
            <% if (locals.assertUserLogged) { %>
                <h2>Preguntale al vendedor</h2>
                <form id="question-form" action="/products/question/<%= fullPost.Post.Product.product_type %>/<%= product.adID %>" method="POST">
                    <div class="form-floating">
                        <textarea class="form-control" name="question" id="question" form="question-form"></textarea>
                        <label for="question">Escribí tu respuesta</label>
                    </div>
                    <button id="askQuestion" type="submit" class="btn btn-primary">Preguntar</button>
                </form>
            <% } %>
            <h2>Preguntas</h2>
            <% fullPost.Post.Question.forEach(e => { %>
                <p class="question"><%= e.question %> - <span class="question-user"><%= e.userName.toUpperCase() %> - <%= e.questionDate.toLocaleString() %></span> <%- e.answer !== "" ? '<i class="fas fa-level-down-alt question-arrow"></i>' : "" %> </p>
                <%- e.answer !== "" ? `<p class="answer"> ${e.answer} - ${e.answerDate.toLocaleString()} </p>` : "" %> 
                
            <% }) %>  
            <% if (questions.length === 0) { %>
                <p>No hay preguntas! Sos el primero!</p>
            <% } %>          
        </div>
        
    </section>
    <div class="modal" id="paymentMethodsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Medios de pago</h5>
            </div>
            <div class="modal-body">
                <p>Estos son los distintos medios de pago</p>
            </div>
        </div>
        </div>
    </div>
</main>
<%- include("./partials/footer") %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
</body>
</html>