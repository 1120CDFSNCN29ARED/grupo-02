<!-- Add Product -->
<%= console.log("estoy en el formulario") %> 
<% if (locals.errors) { %>
    <%= console.log(errors) %> 
<% } %>

<section class="section-add-product" id="add-product-vehicle">
    <form action="/products/<%= action %>/<%= productType %><%= (action === "edit") ? `/${post.postID}?_method=PUT` : "" %> " method="POST" class="add-product" enctype="multipart/form-data">
        <div class="row">
            <div class="col-md">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.vehicleType ? 'is-invalid': null %>" id="vehicleType" aria-label="Select category" name="vehicleType">
                        <option value="car" <%= (locals.post && post.type === "car")?"selected":"" %> >Auto</option>
                        <option value="pickup" <%= (locals.post && post.type === "camioneta")?"pickup":"" %> >Camioneta</option>
                        <option value="motorcycle" <%= (locals.post && post.type === "moto")?"motorcycle":"" %> >Moto</option>
                        <option value="truck" <%= (locals.post && post.type === "camion")?"truck":"" %> >Camion</option>
                    </select>
                    <label for="vehicleType">Tipo de Vehiculo</label>
                    <% if (locals.errors && errors.vehicleType) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleType.msg %>
                        </div>
                    <% } %>
                </div>                
            </div>
        </div>
        <div class="row">
            <div class="col-md col-lg-2">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.vehicleBrand ? 'is-invalid': null %>" id="brand" aria-label="Select brand" name="brand">
                        <option value=""></option>
                        <% for(brand of brands){ %>
                            <option value='<%=brand.brandID%>' <%= (locals.post && post.brandID === brand.brandID)?"selected":"" %>>
                                <%= brand.brandName %>
                            </option>
                            <% } %>
                    </select>
                    <label for="vehicleBrand">Marca</label>
                    <% if (locals.errors && errors.userName) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleBrand.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md col-lg-4">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.vehicleModel ? 'is-invalid': null %>" id="model" aria-label="Select model" name="model">
                    </select>
                    <label for="vehicleModel">Modelo</label>
                    <% if (locals.errors && errors.vechicleModel) { %>
                        <div class="invalid-feedback">
                          <%= errors.vechicleModel.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md col-lg-2">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.vehicleYear ? 'is-invalid': null %>" id="vehicleYear" aria-label="Select Year" name="vehicleYear">
                        <% for(let i=2021;i>=1900;i--){%>
                            <option value='<%=i%>' <%= (locals.post && post.year === i) ? "selected" : "" %>>
                                <%=i%>
                            </option>
                            <% } %>
                    </select>
                    <label for="vehicleYear">Año</label>
                    <% if (locals.errors && errors.vehicleYear) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleYear.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md col-lg-4">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.vehicleVersion ? 'is-invalid': null %>" id="version" aria-label="Select version" name="version">
                        
                    </select>
                    <label for="version">Versión</label>
                    <% if (locals.errors && errors.vehicleVersion) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleVersion.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md col-lg-6">
                <div class="form-floating mb-1 <%=locals.errors && errors.vehicleState ? 'is-invalid': null %>" id="vehicleState" aria-label="Select Part State">
                    <p>Estado</p>
                    <div class="form-check form-check-inline">
                        <input type="radio" name="vehicleState" id="vehicleStateNew" value="Nuevo" <%= (locals.post && post.state === "Nuevo") ? "checked" : "" %>>
                        <label for="vehicleStateNew">Nuevo</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="radio" name="vehicleState" id="vehicleStateUsed" value="Usado" <%= (locals.post && post.state === "Usado") ? "checked" : "" %>>
                        <label for="vehicleStateUsed">Usado</label>
                    </div>
                </div>
                <% if (locals.errors && errors.vehicleState) { %>
                    <div class="invalid-feedback">
                      <%= errors.vehicleState.msg %>
                    </div>
                <% } %>
            </div>
            <!--
            <div class="col-md col-lg-6">
                <div class="form-floating mb-1">
                    
                    <div name="rating" id="rating">
                        <p>Rating</p>
                        <span>
                            <label for="">
                                <input type="radio" name="rating" value="1" class="hide">
                                <i class="far fa-star"></i>
                            </label>
                            <label for="">
                                <input type="radio" name="rating" value="2" class="hide">
                                <i class="far fa-star"></i>
                            </label>
                            <label for="">
                                <input type="radio" name="rating" value="3" class="hide">
                                <i class="far fa-star"></i>
                            </label>
                            <label for="">
                                <input type="radio" name="rating" value="4" class="hide">
                                <i class="far fa-star"></i>
                            </label>
                            <label for="">
                                <input type="radio" name="rating" value="5" class="hide">
                                <i class="far fa-star"></i>
                            </label>
                        </span>
                    </div>
                    
                    <input type="number" name="rating" id="rating">
                    <label for="rating">Rating</label>
                </div>
            </div>
            -->
            <div class="col-md col-lg-6">
                <div class="form-floating mb-1">
                    <input type="number" class="form-control <%=locals.errors && errors.rating ? 'is-invalid': null %>" placeholder="" id="rating" name="rating"
                    value="<%= (locals.post && post.rating) ? post.rating : "" %>"></input>
                    <label for="rating">Rating      
                        <% if (locals.post && post.rating) { %>
                            <% for( let i = 0; i < post.rating; i++ ) { %>
                                <i class="fas fa-star"></i>
                            <% } %>
                            <% if (post.rating < 5 ) { %>
                                <% for( let i = 0; i < (5 - post.rating); i++ ) { %>
                                    <i class="far fa-star"></i>
                                <% } %>
                            <% } %>
                        <% } %>                        
                        <% if (!locals.product) { %>
                            <% for( let i = 0; i < 5; i++ ) { %>
                                <i class="far fa-star"></i>
                            <% } %>
                        <% } %>

                    </label>
                    <% if (locals.errors && errors.rating) { %>
                        <div class="invalid-feedback">
                          <%= errors.rating.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md col-lg-3">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.vehicleGearType ? 'is-invalid': null %>" id="vehicleGearType" aria-label="Select Year" name="vehicleGearType">
                        <option value="automática" <%= (locals.post && post.gearType === "automática") ? "selected" : "" %>>Automática</option>
                        <option value="manual" <%= (locals.post && post.gearType === "manual") ? "selected" : "" %>>Manual</option>
                    </select>
                    <label for="vehicleGearType">Caja de cambios</label>
                    <% if (locals.errors && errors.vehicleGearType) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleGearType.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md col-lg-3">
                <div class="form-floating mb-1">
                    <input type="number" class="form-control <%=locals.errors && errors.vehicleKMs ? 'is-invalid': null %>" placeholder="" id="vehicleKMs" name="vehicleKMs" value="<%= locals.post && post.kilometers %>"></input>
                    <label for="vehicleKMs">Kilometros</label>
                    <% if (locals.errors && errors.vehicleKMs) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleKMs.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md col-lg-3">
                <div class="form-floating mb-1">
                    <input type="number" class="form-control <%=locals.errors && errors.vehiclePrice ? 'is-invalid': null %>" placeholder="" id="vehiclePrice" name="vehiclePrice" value="<%= locals.post && post.price %>"></input>
                    <label for="vehiclePrice">Precio</label>
                    <% if (locals.errors && errors.vehiclePrice) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehiclePrice.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md col-lg-3">
                <div class="form-floating mb-1">
                    <input type="number" name="discount" id="vehicleDiscount" class="form-control <%=locals.errors && errors.discount ? 'is-invalid': null %>" value="<%= (locals.post && post.onSale) ? post.onSale.discount : 0 %>">
                    <label for="discount">Descuento %</label>
                    <% if (locals.errors && errors.vehicleDiscount) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleDiscount.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="form-floating mb-1">
                    <select class="form-select" id="vehicleColor" aria-label="Select Color" name="vehicleColor">
                        <option value="Blanco">Blanco</option>
                        <option value="Negro">Negro</option>
                        <option value="Gris">Gris</option>
                    </select>
                    <label for="VehicleColor">Color Exterior</label>
                    <% if (locals.errors && errors.vehicleColor) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleColor.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.vehicleBrand ? 'is-invalid': null %>" id="province" aria-label="Select brand" name="province">
                        <option value=""></option>
                        <% for(province of provinces){ %>
                            <option value='<%=province.provinceID%>' <%= (locals.post && post.provinceID === province.provinceID)?"selected":"" %>>
                                <%= province.provinceName %>
                            </option>
                            <% } %>
                    </select>
                    <label for="province">Provincia</label>
                    <% if (locals.errors && errors.province) { %>
                        <div class="invalid-feedback">
                          <%= errors.province.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-floating mb-1">
                    <select class="form-select <%=locals.errors && errors.location ? 'is-invalid': null %>" id="location" aria-label="Select city" name="location">
                    </select>
                    <label for="location">Ciudad</label>
                    <% if (locals.errors && errors.location) { %>
                        <div class="invalid-feedback">
                          <%= errors.location.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-floating mb-1">
                    <input type="text" class="form-control <%=locals.errors && errors.vehiclePostalCode ? 'is-invalid': null %>" name="vehiclePostalCode" id="vehiclePostalCode" value="<%= (locals.post && post.location) ? post.location.postalCode : "" %>">
                    <label for="vehiclePostalCode">Código Postal</label>
                    <% if (locals.errors && errors.vehiclePostalCode) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehiclePostalCode.msg %>
                        </div>
                    <% } %>
                </div>                
            </div>
        </div>
        <div class="col-md">
            <div class="form-floating mb-1">
                <input type="text" class="form-control <%=locals.errors && errors.title ? 'is-invalid': null %>" name="title" id="title" value="<%= (locals.post && post.title) ? post.title : "" %>">
                <label for="title">Título</label>
                <% if (locals.errors && errors.title) { %>
                    <div class="invalid-feedback">
                      <%= errors.title.msg %>
                    </div>
                <% } %>
            </div>
        </div>
        <div class="row">
            <div class="col-md">
                <div class="form-floating mb-1">
                    <textarea class="form-control <%=locals.errors && errors.vehicleDescription? 'is-invalid': null %>" name="vehicleDescription" id="vehicleDescription"><%= (locals.post && post.description) ? post.description : "" %></textarea>
                    <label for="vehicleDescription">Descripción</label>
                    <% if (locals.errors && errors.vehicleDescription) { %>
                        <div class="invalid-feedback">
                          <%= errors.vehicleDescription.msg %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        <% if (action === "create") { %>
            <div class="row">
                <div class="col-md">
                    <div class="form-floating mb-1">
                        <input type="file" name="productImages" id="productImages" class="form-control input-file" multiple>
                        <label for="productImages">Seleccione hasta 5 imágenes para su producto</label>
                        <% if (locals.errors && errors.productImages) { %>
                            <div class="invalid-feedback">
                              <%= errors.productImages.msg %>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        <% } else if (action === "edit" && locals.post && post.imageURLs[0] && post.imageURLs[0] !== "no-image-found.jpeg") { %>
            <div class="row">
                <div class="form-floating mb-1">
                    <input type="file" name="productImages" id="productImages" class="form-control input-file <%=locals.errors && errors.vehicleState ? 'is-invalid': null %>" multiple>
                    <label for="productImages">Seleccione imágenes (hasta 5 en total) para su producto</label>
                </div>
                <div class="current-product-images">
                    <p>Imagenes actuales</p>
                <% for( let i = 0; i < 5; i++ ) { %>
                    <div class="current-product-image-container">
                        <ul>
                            <li>
                                <% if (locals.post && post.imageURLs[i] && post.imageURLs[i] !== "no-image-found.jpeg") { %>
                                    <img src="<%= post.imageURLs.length && (post.imageURLs)[i].includes("http") ? post.imageURLs[i] : `/img/products/${post.imageURLs[i]}` %>" alt="image-product-<%= i %>" class="edit-product-img">
                                    <a class="btn btn-danger" href="<%- `/products/deleteImage/${productType}/${productID}?image=${post.imageURLs[i]}` %>">
                                        Borrar
                                    </a>
                                <% } %>
                            </li>
                        </ul>
                    </div>
                <% } %>
                </div>
            </div>
        <% } %>
        <!-- Buttons Section -->
        <div class="container-fluid d-flex container-add-product-cta">
            <div class="add-product-cta"><button class="add-product-reset btn-lg" type="reset">Resetear</button></div>
            <div class="add-product-cta"><button class="add-product-confirm btn-lg" type="submit" name="submit" value="publish">Guardar y Publicar</button></div>          
            <div class="add-product-cta"><button class="add-product-save btn-lg" type="submit" name="submit" value="save">Guardar</button></div>
            
        </div>
    </form>
    <% if (action === "edit") { %>
        <form action="/products/delete/<%= productType %>/<%= post.postID %>?_method=DELETE" method="POST">
            <div class="add-product-cta"><button class="add-product-delete btn-lg" type="submit" name="delete">Borrar</button></div>
        </form>
    <% } %>
</section>
<script src="/js/getModels.js"></script>
<script src="/js/getVersions.js"></script>
<script src="/js/getLocalities.js"></script>